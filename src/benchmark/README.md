# Benchmark Data Preparation and Execution

This section contains scripts to prepare and run benchmark datasets for RNA sequence analysis. The benchmark datasets are generated from RNA sequences and are used to evaluate the performance of various RNA classification models.

## Scripts Overview

### 1. `prepare-benchmark-data.ipynb`

This Jupyter notebook is responsible for preparing the benchmark datasets. It performs the following tasks:

1. **Load and Filter Data**: Loads the RNA sequences from a CSV file and filters them based on specific criteria.
2. **Cluster Sequences**: Uses CD-HIT to cluster RNA sequences and remove redundancy.
3. **Data Cleaning**: Cleans the dataset by ensuring consistency in RNA types and removing forced RNA types.
4. **Summarize Dataset**: Provides a summary of the dataset, including counts of RNA types and unique RFAM categories.
5. **Sample Data**: Samples the dataset to create subsets for benchmark datasets, including special cases for specific RNA types.
6. **Generate Benchmark Datasets**: Creates pairwise combinations of RNA sequences for positive and negative samples and saves them as benchmark datasets.
7. **Plotting**: Generates plots to visualize the distribution of RNA types and RFAM categories in the sampled datasets.

#### Example Benchmark Datasets

- **RNA Type Classification**: Generates pairs of RNA sequences where positive samples have the same RNA type and negative samples have different RNA types and RFAMs.
- **Easy RFAM Classification**: Generates pairs of RNA sequences where positive samples have the same RNA type and RFAM, and negative samples have different RNA types and RFAMs.

The notebook also generates metadata JSON files that contain information about the sampled datasets and benchmark datasets, including creation time, version, and unique IDs.

### 2. `benchmark.py`

This script is used to run the benchmark on the prepared datasets. It performs the following tasks:

1. **Load Benchmark Datasets**: Loads the benchmark datasets generated by the `prepare-benchmark-data.ipynb` notebook.
2. **Run Benchmark**: Executes the benchmark by comparing RNA sequences based on specific conditions (e.g., same RNA type, same RFAM).
3. **Evaluate Performance**: Evaluates the performance of RNA classification models using the benchmark datasets.
4. **Generate Reports**: Generates reports summarizing the benchmark results.

#### Parameters

- `--model-script`: Path to the model script. Default: "./strusinet.py".
- `--benchmark-metadata`: Name of the JSON file containing benchmark dataset information (in --datasets-dir). Default: 'benchmarking_datasets.json'.
- `--datasets-dir`: Directory containing the benchmark metadata JSON, primary sampled datasets, and benchmark datasets. Default: './datasets'.
- `--benchmark-datasets`: Specify one or more benchmark datasets by name or name-version. If not provided, uses all latest versions.
- `--save-embeddings`: If set, embeddings will be saved. Ignored if --no-save is given.
- `--emb-output-path`: Output path for embeddings if save_embeddings is set.
- `--structure-column-name`: Name of the column with RNA secondary structures. Default: "secondary_structure".
- `--structure-column-num`: Column number of the RNA secondary structures (0-indexed). If both name and num provided, name takes precedence.
- `--model-path`: Path to the trained model file. Default: "saved_model/ResNet-Secondary.pth".
- `--header`: Specify whether input CSV files have a header (True/False). Default: True.
- `--skip-barplot`: Skip generating the AUC barplot.
- `--skip-auc-curve`: Skip generating the ROC curve.
- `--results-path`: Path to save results. Time-stamp appended unless --no-save is specified. Default: "./benchmarking_results".
- `--save-distances`: Save the benchmark dataframes with the distance column.
- `--no-save`: Do not save any output files.
- `--only-needed-embeddings`: If set, only generate embeddings for RNAcentral IDs required by the benchmarks.
- `--no-log`: If set, no log file will be created.

## How to Use

### Preparing Benchmark Datasets

1. Open the `prepare-benchmark-data.ipynb` notebook.
2. Follow the steps in the notebook to load, filter, and clean the RNA sequences.
3. Sample the dataset to create subsets for benchmark datasets.
4. Generate pairwise combinations for positive and negative samples.
5. Save the benchmark datasets and metadata.

### Running the Benchmark

1. Ensure that the benchmark datasets are prepared and saved in the specified directory.
2. Run the `benchmark.py` script with the appropriate parameters to execute the benchmark.
3. Review the generated reports to evaluate the performance of RNA classification models.

## Directory Structure

```
benchmark/
├── prepare-benchmark-data.ipynb
├── benchmark.py
├── datasets/
│   ├── filtered_rfam_90.csv
│   ├── unpaired_rnas_rfam_benchmark-v1.tsv
│   ├── rna_type_benchmark_small-v1.tsv
│   ├── rna_type_benchmark-v1.tsv
│   ├── rna_type_benchmark_big-v1.tsv
│   ├── easy_rfam_benchmark_small-v1.tsv
│   ├── easy_rfam_benchmark-v1.tsv
│   ├── easy_rfam_benchmark_big-v1.tsv
│   ├── hard_rfam_benchmark_small-v1.tsv
│   ├── hard_rfam_benchmark-v1.tsv
│   ├── hard_rfam_benchmark_big-v1.tsv
│   └── benchmark_datasets.json
```

## Notes

- Ensure that all dependencies are installed before running the scripts.
- The `prepare-benchmark-data.ipynb` notebook requires CD-HIT to be installed for clustering RNA sequences.
- The `benchmark.py` script should be customized based on the specific requirements of the RNA classification models being evaluated.
