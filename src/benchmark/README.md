# Benchmark Data Preparation and Execution

This section contains scripts to prepare and run benchmark datasets for RNA sequence analysis. The benchmark datasets are generated from RNA sequences and are used to evaluate the performance of various RNA classification models.

## Scripts Overview

### 1. `prepare-benchmark-data.ipynb`

This Jupyter notebook is responsible for preparing the benchmark datasets. It performs the following tasks:

1. **Load and Filter Data**: Loads the RNA sequences from a CSV file and filters them based on specific criteria.
2. **Cluster Sequences**: Uses CD-HIT to cluster RNA sequences and remove redundancy.
3. **Data Cleaning**: Cleans the dataset by ensuring consistency in RNA types and removing forced RNA types.
4. **Summarize Dataset**: Provides a summary of the dataset, including counts of RNA types and unique RFAM categories.
5. **Sample Data**: Samples the dataset to create subsets for benchmark datasets, including special cases for specific RNA types.
6. **Generate Benchmark Datasets**: Creates pairwise combinations of RNA sequences for positive and negative samples and saves them as benchmark datasets.
7. **Plotting**: Generates plots to visualize the distribution of RNA types and RFAM categories in the sampled datasets.

#### Example Benchmark Datasets

- **RNA Type Classification**: Generates pairs of RNA sequences where positive samples have the same RNA type and negative samples have different RNA types and RFAMs.
- **Easy RFAM Classification**: Generates pairs of RNA sequences where positive samples have the same RNA type and RFAM, and negative samples have different RNA types and RFAMs.

The notebook also generates metadata JSON files that contain information about the sampled datasets and benchmark datasets, including creation time, version, and unique IDs.

### 2. `benchmark.py`

This script is used to run the benchmark on the prepared datasets. It performs the following tasks:

1. **Load Benchmark Datasets**: Loads the benchmark datasets generated by the `prepare-benchmark-data.ipynb` notebook.
2. **Run Benchmark**: Executes the benchmark by comparing RNA sequences based on specific conditions (e.g., same RNA type, same RFAM).
3. **Evaluate Performance**: Evaluates the performance of RNA classification models using the benchmark datasets.
4. **Generate Reports**: Generates reports summarizing the benchmark results.

## Parameters

### Required Parameters
- `--model_type`: Type of model to use ('siamese' or 'gin').
- `--model-path`: Path to the trained model weights file.

### Model Configuration
- `--embeddings-script`: Path to the embeddings generation script. Default: "./predict_embedding.py"
- `--hidden_dim`: Hidden dimension size for the model. Default: 256
- `--output_dim`: Output embedding size for the GIN model (ignored for siamese). Default: 128
- `--gin_layers`: Number of GIN layers (only for GIN model)
- `--graph_encoding`: Encoding for graph transformation ('standard' or 'forgi'). Default: 'standard'

### Input/Output Configuration
- `--benchmark-metadata`: JSON file containing benchmark dataset information. Default: 'benchmark_datasets.json'
- `--datasets-dir`: Directory containing benchmark datasets. Default: 'data/benchmark_datasets'
- `--benchmark-datasets`: Specify benchmark datasets by name or name-version
- `--results-path`: Path to save results. Default: "./benchmarking_results"
- `--emb-output-path`: Output path for embeddings. Default: 'benchmarking_results/embeddings'

### Data Processing
- `--structure-column-name`: Name of the RNA structure column
- `--structure-column-num`: Index of the RNA structure column (0-based)
- `--header`: Whether input files have headers ('True'/'False'). Default: 'True'

### Performance Options
- `--device`: Computation device ('cuda' or 'cpu'). Default: 'cuda' if available
- `--num_workers`: Number of worker processes. Default: 4
- `--distance-batch-size`: Batch size for distance calculations. Default: 1000

### Output Control
- `--save-embeddings`: Save the generated embeddings
- `--save-distances`: Save the distance calculations
- `--no-save`: Don't save any output files
- `--no-log`: Don't create log files
- `--skip-barplot`: Skip generating AUC barplots
- `--skip-auc-curve`: Skip generating ROC curves
- `--only-needed-embeddings`: Only generate embeddings required by benchmarks

## How to Use

### Preparing Benchmark Datasets

1. Open the `prepare-benchmark-data.ipynb` notebook.
2. Follow the steps in the notebook to load, filter, and clean the RNA sequences.
3. Sample the dataset to create subsets for benchmark datasets.
4. Generate pairwise combinations for positive and negative samples.
5. Save the benchmark datasets and metadata.

### Running the Benchmark

1. Ensure that the benchmark datasets are prepared and saved in the specified directory.
2. Run the `benchmark.py` script with the appropriate parameters to execute the benchmark.
3. Review the generated reports to evaluate the performance of RNA classification models.

### Example Usage
```
python benchmark.py --model_type siamese --model-path path/to/model --benchmark-metadata benchmark_datasets.json --datasets-dir data/benchmark_datasets --results-path ./benchmarking_results
```

## Directory Structure

```
benchmark/
├── prepare-benchmark-data.ipynb
├── benchmark.py
├── datasets/
│   ├── filtered_rfam_90.csv
│   ├── unpaired_rnas_rfam_benchmark-v1.tsv
│   ├── rna_type_benchmark_small-v1.tsv
│   ├── rna_type_benchmark-v1.tsv
│   ├── rna_type_benchmark_big-v1.tsv
│   ├── easy_rfam_benchmark_small-v1.tsv
│   ├── easy_rfam_benchmark-v1.tsv
│   ├── easy_rfam_benchmark_big-v1.tsv
│   ├── hard_rfam_benchmark_small-v1.tsv
│   ├── hard_rfam_benchmark-v1.tsv
│   ├── hard_rfam_benchmark_big-v1.tsv
│   └── benchmark_datasets.json
```

## Notes

- Ensure that all dependencies are installed before running the scripts.
- The `prepare-benchmark-data.ipynb` notebook requires CD-HIT to be installed for clustering RNA sequences.
- The `benchmark.py` script should be customized based on the specific requirements of the RNA classification models being evaluated.
